<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éº»é›€è¨ˆåˆ†å™¨ - å‹•æ£®é¢¨æ ¼</title>
    <!-- Tailwind CSS CDN --><script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ========================================= */
        /* ACNH STYLE VARIABLES & CORE STYLES */
        /* ========================================= */
        :root {
            /* ACNH Color Palette */
            --color-sky-blue: #BBE1F4; /* èƒŒæ™¯å¤©ç©º/æµ·æ´‹ */
            --color-grass-green: #97CE66; /* ä¸»è¦è¡Œå‹• (ç¶ è‰²è‰åœ°) */
            --color-accent-yellow: #FAD36E; /* äº®é»ƒè‰² (é“å…·/é‡è¦è¨Šæ¯) */
            --color-earth-brown: #C9A27F; /* å¡ç‰‡é‚Šæ¡†/æœ¨é ­ */
            --color-text-dark: #4A4A4A; /* æ·±è‰²æ–‡å­— */
            --color-text-light: #6A6A6A; /* æ·ºè‰²æ–‡å­— */
            --color-modal-bg: #FFFFFF; /* æ¨¡æ…‹æ¡†èƒŒæ™¯ */
            --color-score-card: #FFF8E1; /* åˆ†æ•¸å¡ç‰‡èƒŒæ™¯ (å¥¶æ²¹è‰²) */
            --color-plus: #4CAF50; /* åŠ åˆ†ç¶  */
            --color-minus: #F44336; /* æ¸›åˆ†ç´… */
            --color-button-shadow-green: #7BAA4E;
            --color-button-shadow-yellow: #D1A45D;
            --color-button-shadow-blue: #5B81B3;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-sky-blue);
            color: var(--color-text-dark);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px 10px;
            touch-action: manipulation;
        }

        /* ä¸»å®¹å™¨æ¨£å¼ (å³¶å¶¼å‘Šç¤ºæ¿/å¡ç‰‡) */
        .acnh-card {
            background-color: white;
            border-radius: 40px; /* æ¥µåº¦åœ“æ½¤ */
            padding: 2.5rem 2rem;
            margin-top: 2rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1), 0 0 0 4px var(--color-earth-brown); /* é›™å±¤é™°å½± */
            max-width: 95%;
            width: 700px;
        }

        /* æ¨™é¡Œ (åƒå³¶å¶¼åç¨±) */
        h1 {
            color: var(--color-grass-green);
            font-weight: 800;
            text-shadow: 2px 2px 0 #FFF; /* ç™½è‰²æé‚Šæ•ˆæœ */
        }

        /* å‹•ç‰©æ£®å‹æœƒé¢¨æ ¼æŒ‰éˆ• (åœ“é‚Šä¸”æœ‰æµ®å‡¸æ„Ÿ) */
        .acnh-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.8rem 1.5rem;
            min-width: 130px; /* ç¢ºä¿åœ¨ç§»å‹•ç«¯æœ‰è¶³å¤ é»æ“Šå€åŸŸ */
            font-size: 1rem;
            font-weight: 700;
            border: none;
            border-radius: 9999px; /* æ¥µåœ“é‚Š */
            cursor: pointer;
            transition: all 0.1s ease-out;
            color: white;
            text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.1);
        }
        
        /* åŸºç¤æŒ‰éˆ•å‹•ç•« */
        .acnh-button:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
        }

        .acnh-button:active {
            transform: translateY(3px); /* æŒ‰ä¸‹æ™‚å‘ä¸‹ç§»å‹• */
            box-shadow: 0 2px 0 0 !important; /* é™°å½±è®Šå° */
        }
        
        .acnh-button:disabled {
            filter: grayscale(0.8);
            cursor: not-allowed;
            transform: none;
            box-shadow: none !important;
        }

        /* é»ƒè‰²æŒ‰éˆ• (Reset) */
        .acnh-button.yellow {
            background-color: var(--color-accent-yellow);
            box-shadow: 0 5px 0 0 var(--color-button-shadow-yellow);
        }
        .acnh-button.yellow:hover {
            box-shadow: 0 7px 0 0 var(--color-button-shadow-yellow);
        }

        /* ç¶ è‰²æŒ‰éˆ• (Add Score) */
        .acnh-button.green-main {
            background-color: var(--color-grass-green);
            box-shadow: 0 5px 0 0 var(--color-button-shadow-green);
        }
        .acnh-button.green-main:hover {
            box-shadow: 0 7px 0 0 var(--color-button-shadow-green);
        }
        
        /* è—è‰²æŒ‰éˆ• (Setup Names) */
        .acnh-button.blue-main {
            background-color: #79A3D3;
            box-shadow: 0 5px 0 0 var(--color-button-shadow-blue);
        }
        .acnh-button.blue-main:hover {
            box-shadow: 0 7px 0 0 var(--color-button-shadow-blue);
        }

        /* åˆ†æ•¸å¡ç‰‡æ¨£å¼ */
        .score-card {
            background-color: var(--color-score-card);
            border-radius: 20px;
            box-shadow: 0 4px 0 0 #D3C9AD; /* æ·ºæ£•è‰²åº•éƒ¨é™°å½± */
            transition: transform 0.2s;
        }
        .score-card:hover {
            transform: translateY(-2px);
        }

        /* æ¨¡æ…‹æ¡†æ¨£å¼ */
        .modal-content {
            background-color: var(--color-modal-bg);
            border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
        }

        /* æ¶ˆé™¤ input æ•¸å­—ç®­é ­ */
        .no-spinners::-webkit-outer-spin-button,
        .no-spinners::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .no-spinners {
            -moz-appearance: textfield;
        }

        /* ========================================= */
        /* FIREBASE & CORE LOGIC (START) */
        /* ========================================= */
    </style>
    <!-- Firebase Imports --><script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // è¨­å®š Firebase Log Level
        setLogLevel('Debug');
        
        // --- START: CONFIGURATION & ENVIRONMENT HANDLING ---
        // æ›´æ–°é è¨­ç©å®¶åç¨±
        const DEFAULT_PLAYER_NAMES = ['å³¶æ°‘A', 'å³¶æ°‘B', 'å³¶æ°‘C', 'å³¶æ°‘D'];
        
        const CANVAS_FALLBACK_CONFIG = {
            apiKey: "AIzaSyAucSfEkaiVy4fo26owposx2WUGIDEkSPQ",
            authDomain: "kiwimj.firebaseapp.com",
            projectId: "kiwimj",
            storageBucket: "kiwimj.firebasestorage.app",
            messagingSenderId: "909819524840",
            appId: "1:909819524840:web:67cc2c9b7c03bb10827b5d",
            measurementId: "G-6HVF2N100E"
        };

        const firebaseConfig = typeof __firebase_config !== 'undefined' 
            ? JSON.parse(__firebase_config) 
            : CANVAS_FALLBACK_CONFIG;
            
        const appId = typeof __app_id !== 'undefined' ? __app_id : firebaseConfig.projectId;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // --- END: CONFIGURATION & ENVIRONMENT HANDLING ---

        let db, auth;
        let userId = null;

        // --- Application State ---
        const createDefaultPlayers = () => DEFAULT_PLAYER_NAMES.map((name, index) => ({
            id: index,
            name: name,
            score: 0
        }));
        
        let players = createDefaultPlayers();
        let gameHistory = [];
        const STEP_VALUE = 1;

        // --- DOM Elements ---
        const scoreDisplay = document.getElementById('score-display');
        const roundInputsContainer = document.getElementById('round-inputs-container');
        const roundTotalChange = document.getElementById('round-total-change');
        const historyList = document.getElementById('history-list');
        const userIdDisplay = document.getElementById('user-id-display');
        
        // --- Core Utility Functions (Exposed to window for inline events) ---

        /** èª¿æ•´åˆ†æ•¸è®Šå‹•å€¼ä¸¦é‡æ–°è¨ˆç®—ç¸½å’Œ */
        function adjustChange(playerId, amount) {
            const input = document.getElementById(`change-${playerId}`);
            if (input) {
                let currentValue = parseInt(input.value || 0, 10);
                currentValue += amount;
                input.value = currentValue;
                calculateRoundTotal();
            }
        }

        /** è¨ˆç®—å›åˆç¸½è®Šå‹•ï¼Œä¸¦æ§åˆ¶ç¢ºèªæŒ‰éˆ•ç‹€æ…‹ */
        function calculateRoundTotal() {
            let total = 0;
            players.forEach(player => {
                const input = document.getElementById(`change-${player.id}`);
                if (input) {
                    total += parseInt(input.value || 0, 10);
                }
            });
            roundTotalChange.textContent = `ç¸½è®Šå‹•: ${total}`;
            const confirmBtn = document.getElementById('confirm-round-btn');
            
            // ACNH Style color for text
            if (total === 0) {
                roundTotalChange.classList.remove('text-red-600');
                roundTotalChange.classList.add('text-green-600');
                confirmBtn.disabled = false;
                confirmBtn.classList.remove('opacity-50', 'cursor-not-allowed', 'acnh-button-disabled');
            } else {
                roundTotalChange.classList.remove('text-green-600');
                roundTotalChange.classList.add('text-red-600');
                confirmBtn.disabled = true;
                confirmBtn.classList.add('opacity-50', 'cursor-not-allowed', 'acnh-button-disabled');
            }
        }

        window.adjustChange = adjustChange;
        window.calculateRoundTotal = calculateRoundTotal;


        // --- Initialization and Authentication ---

        async function initializeFirebase() {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase configuration is missing.");
                    alertMessage('éŒ¯èª¤: ç¼ºå°‘ Firebase é…ç½®ã€‚ç„¡æ³•å„²å­˜è³‡æ–™ã€‚', 'red');
                    return;
                }
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app); 

                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                        console.log("Signed in with Custom Token.");
                    } else {
                        await signInAnonymously(auth);
                        console.log("Signed in Anonymously (using fallback config).");
                    }
                } catch (e) {
                    console.error("Firebase Sign-In Failed:", e);
                    alertMessage('éŒ¯èª¤: ç„¡æ³•å»ºç«‹ç”¨æˆ¶æœƒè©±ã€‚è«‹æª¢æŸ¥ Firebase å°ˆæ¡ˆè¨­å®šã€‚', 'red');
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("Authenticated user ID:", userId);
                        // ACNH Style text for ID
                        userIdDisplay.innerHTML = `<span class="text-sm">æˆ‘çš„å³¶å¶¼è™Ÿç¢¼ (å…±äº«éµ): </span><span class="font-mono text-xs break-all">${userId}</span>`;
                        setupRealtimeListener();
                    } else {
                        console.log("User state changed to signed out.");
                    }
                });

            } catch (error) {
                console.error("Firebase Initialization Error:", error);
                alertMessage(`Firebase åˆå§‹åŒ–å¤±æ•—: ${error.message}`, 'red');
            }
        }

        // --- Firestore Operations ---

        function getGameDocRef() {
            if (!db) return null;
            return doc(db, 'artifacts', appId, 'public', 'data', 'mahjongScores', 'current_game');
        }

        function setupRealtimeListener() {
            const gameRef = getGameDocRef();
            if (!gameRef) return;

            onSnapshot(gameRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    players = data.players || players;
                    gameHistory = data.history || gameHistory;
                    renderUI();
                } else {
                    saveGameState();
                }
            }, (error) => {
                console.error("Firestore Listener Error:", error);
                alertMessage(`æ•¸æ“šåŒæ­¥å¤±æ•—: ${error.message}`, 'red');
            });
        }

        async function saveGameState() {
            const gameRef = getGameDocRef();
            if (!gameRef || !userId) {
                if (auth.currentUser) {
                    alertMessage('éŒ¯èª¤: å°šæœªå®Œæˆèº«ä»½é©—è­‰ï¼Œç„¡æ³•å„²å­˜ã€‚', 'red');
                }
                return;
            }

            const stateToSave = {
                players: players,
                history: gameHistory,
                lastUpdated: new Date().toISOString(),
                ownerId: userId
            };

            try {
                await setDoc(gameRef, stateToSave, { merge: true });
            } catch (e) {
                console.error("Error saving document: ", e);
                alertMessage(`å„²å­˜å¤±æ•—: ${e.message}`, 'red');
            }
        }

        // --- UI Rendering Functions ---

        function renderUI() {
            if (scoreDisplay) renderScores();
            if (historyList) renderHistory();
        }

        function renderScores() {
            if (!scoreDisplay) return;
            scoreDisplay.innerHTML = players.map(player => `
                <div class="score-card p-4 flex justify-between items-center transition duration-300">
                    <div class="text-lg font-semibold text-var-text-dark">${player.name}</div>
                    <div id="score-${player.id}" class="text-3xl font-bold" style="color: ${player.score >= 0 ? 'var(--color-plus)' : 'var(--color-minus)'};">
                        ${player.score}
                    </div>
                </div>
            `).join('');
        }

        function renderPlayerSetupInputs() {
            const container = document.getElementById('setup-inputs-container');
            if (!container) return;
            // Use ACNH style input fields
            container.innerHTML = players.map(player => `
                <div class="mb-4">
                    <label for="name-${player.id}" class="block text-sm font-medium text-var-text-light">å³¶æ°‘ ${player.id + 1} åç¨±</label>
                    <input type="text" id="name-${player.id}" value="${player.name}"
                           class="mt-1 block w-full px-4 py-2 bg-gray-100 border border-gray-300 rounded-lg text-var-text-dark focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 sm:text-lg">
                </div>
            `).join('');
        }

        function renderRoundInputs() {
            const LOCAL_STEP = STEP_VALUE;
            roundInputsContainer.innerHTML = players.map(player => `
                <div class="flex items-center space-x-2 mb-4">
                    <label class="w-1/3 text-lg font-semibold text-var-text-dark">${player.name}</label>
                    <div class="w-2/3 flex items-center bg-gray-100 border border-gray-300 rounded-lg overflow-hidden shadow-inner">
                        <!-- Minus Button --><button onclick="window.adjustChange(${player.id}, -${LOCAL_STEP})" 
                                type="button" 
                                class="w-1/4 h-12 bg-red-400 hover:bg-red-500 text-white font-bold text-xl transition duration-150 active:scale-[0.95]">
                            -
                        </button>
                        <!-- Input Field --><input type="number" id="change-${player.id}" value="0" placeholder="Â± è®Šå‹•"
                               class="w-2/4 text-center px-2 py-1 bg-gray-100 text-var-text-dark font-bold text-xl no-spinners focus:outline-none" style="border-left: 1px solid #ddd; border-right: 1px solid #ddd;">
                        <!-- Plus Button --><button onclick="window.adjustChange(${player.id}, ${LOCAL_STEP})" 
                                type="button" 
                                class="w-1/4 h-12 bg-green-400 hover:bg-green-500 text-white font-bold text-xl transition duration-150 active:scale-[0.95]">
                            +
                        </button>
                    </div>
                </div>
            `).join('');
            
            players.forEach(player => {
                const inputEl = document.getElementById(`change-${player.id}`);
                if (inputEl) {
                    inputEl.addEventListener('input', calculateRoundTotal);
                }
            });
            calculateRoundTotal();
        }

        function renderHistory() {
            if (!historyList) return;
            historyList.innerHTML = '';
            if (gameHistory.length === 0) {
                historyList.innerHTML = '<p class="text-center py-4" style="color: var(--color-text-light);">é‚„æ²’æœ‰å°å±€ç´€éŒ„å–”ï¼Œå¿«ä¾†ç©å§ï¼</p>';
                return;
            }

            gameHistory.slice(0, 10).reverse().forEach((round, index) => {
                const roundIndex = gameHistory.length - index;
                const date = new Date(round.timestamp).toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });

                const detail = round.changes.map(change => `
                    <div class="flex justify-between text-sm py-1 border-b border-gray-200 last:border-b-0">
                        <span style="color: var(--color-text-light);">${players.find(p => p.id === change.playerId)?.name || 'æœªçŸ¥ç©å®¶'}</span>
                        <span class="font-medium" style="color: ${change.change >= 0 ? 'var(--color-plus)' : 'var(--color-minus)'};">
                            ${change.change > 0 ? '+' : ''}${change.change}
                        </span>
                    </div>
                `).join('');

                // ACNH Style history item
                historyList.innerHTML += `
                    <li class="bg-gray-50 p-3 rounded-xl mb-3 border-l-4 border-yellow-500 shadow-sm">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-sm font-bold text-yellow-600">${roundIndex} å±€ç´€éŒ„</span>
                            <span class="text-xs" style="color: var(--color-text-light);">${date}</span>
                        </div>
                        <div class="mt-2 space-y-1">
                            ${detail}
                        </div>
                    </li>
                `;
            });
        }

        // --- Core Logic Functions ---

        function applyRoundScores() {
            const changes = [];
            players.forEach(player => {
                const input = document.getElementById(`change-${player.id}`);
                const change = parseInt(input.value || 0, 10);
                changes.push({ playerId: player.id, change: change });
            });

            const totalChange = changes.reduce((sum, item) => sum + item.change, 0);

            if (totalChange !== 0) {
                alertMessage('éŒ¯èª¤: ç©åˆ†ç¸½è®Šå‹•å¿…é ˆç‚ºé›¶ï¼', 'red');
                return;
            }

            const newPlayers = players.map(player => {
                const changeObj = changes.find(c => c.playerId === player.id);
                return {
                    ...player,
                    score: player.score + changeObj.change
                };
            });
            players = newPlayers;

            const roundRecord = {
                timestamp: new Date().toISOString(),
                changes: changes
            };
            gameHistory.push(roundRecord);

            saveGameState();
            hideModal('round-modal');
            alertMessage('ç©åˆ†å·²æˆåŠŸçµç®—ï¼', 'green');
        }

        function savePlayerNames() {
            let namesChanged = false;
            const newPlayers = players.map(player => {
                const input = document.getElementById(`name-${player.id}`);
                const newName = input.value.trim() || DEFAULT_PLAYER_NAMES[player.id];
                if (player.name !== newName) {
                    namesChanged = true;
                }
                return { ...player, name: newName };
            });
            players = newPlayers;

            if (namesChanged) {
                saveGameState();
                alertMessage('å³¶æ°‘åç¨±å·²å„²å­˜ï¼', 'green');
            }
            hideModal('setup-modal');
        }

        function resetGame() {
            const input = document.getElementById('reset-verification-input');
            if (input) {
                input.value = '';
            }
            showModal('reset-confirm-modal');
        }

        function performReset() {
            const verificationInput = document.getElementById('reset-verification-input');
            const requiredPhrase = "HELLO KIWI";

            if (!verificationInput || verificationInput.value.trim() !== requiredPhrase) {
                alertMessage(`å®‰å…¨é©—è­‰å¤±æ•—ï¼šæ‚¨å¿…é ˆè¼¸å…¥ "${requiredPhrase}" æ‰èƒ½é‡è¨­éŠæˆ²ã€‚`, 'red');
                verificationInput.value = '';
                return;
            }

            players = createDefaultPlayers();
            gameHistory = [];
            saveGameState();
            alertMessage('å³¶å¶¼å·²é‡å•Ÿï¼æ‰€æœ‰ç´€éŒ„å·²æ¸…ç©ºã€‚', 'green');
            hideModal('reset-confirm-modal');
        }
        
        // --- Utility Functions (Modals & Alerts) ---

        function showModal(id) {
            const modal = document.getElementById(id);
            if (modal) modal.classList.remove('hidden');
        }

        function hideModal(id) {
            const modal = document.getElementById(id);
            if (modal) modal.classList.add('hidden');
        }

        function alertMessage(message, type) {
            const container = document.getElementById('alert-container');
            if (!container) return;
            
            // ACNH Style colors for alerts
            const colorClass = type === 'red' ? 'bg-red-500' : 'bg-green-500';

            const alertEl = document.createElement('div');
            alertEl.className = `p-3 rounded-full text-white font-medium ${colorClass} shadow-xl mb-2 transition-opacity duration-300`;
            alertEl.textContent = message;

            container.appendChild(alertEl);

            setTimeout(() => {
                alertEl.classList.add('opacity-0');
                alertEl.addEventListener('transitionend', () => alertEl.remove());
            }, 3000);
        }

        // --- Event Listeners and Initial Load ---
        window.onload = () => {
            initializeFirebase();
        };

        document.addEventListener('DOMContentLoaded', () => {
            const openRoundBtn = document.getElementById('open-round-modal');
            const openSetupBtn = document.getElementById('open-setup-modal');
            const confirmRoundBtn = document.getElementById('confirm-round-btn');
            const saveNamesBtn = document.getElementById('save-names-btn');
            const resetGameBtn = document.getElementById('reset-game-btn');
            const confirmResetBtn = document.getElementById('confirm-reset-btn');
            
            if (openRoundBtn) openRoundBtn.addEventListener('click', () => {
                renderRoundInputs();
                showModal('round-modal');
            });
            
            if (openSetupBtn) openSetupBtn.addEventListener('click', () => {
                renderPlayerSetupInputs();
                showModal('setup-modal');
            });
            
            if (confirmRoundBtn) confirmRoundBtn.addEventListener('click', applyRoundScores);
            if (saveNamesBtn) saveNamesBtn.addEventListener('click', savePlayerNames);
            
            if (resetGameBtn) resetGameBtn.addEventListener('click', resetGame); 
            if (confirmResetBtn) confirmResetBtn.addEventListener('click', performReset);

            document.querySelectorAll('.close-modal-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const modalId = e.target.closest('.modal')?.id;
                    if (modalId) {
                       hideModal(modalId);
                    }
                });
            });

            renderUI();
        });

    </script>
</head>
<body class="min-h-screen">
    
    <!-- Global Alert Container --><div id="alert-container" class="fixed top-0 right-0 m-4 z-50 w-full max-w-sm">
        <!-- Alerts will be injected here --></div>

    <div class="acnh-card max-w-4xl mx-auto relative z-10">
        <!-- æ¨™é¡Œå·²ç§»é™¤ Emoji -->
        <h1 class="text-3xl sm:text-4xl text-center mb-3">ã€Šé›†åˆå•¦ï¼é›€å‹äº¤æµæœƒã€‹</h1>
        
        <!-- User ID: ACNH style display --><p id="user-id-display" class="text-center text-sm mb-6 p-2 rounded-xl border border-gray-300 bg-gray-50" style="color: var(--color-text-light);">æˆ‘çš„å³¶å¶¼è™Ÿç¢¼ (å…±äº«éµ): è¼‰å…¥ä¸­...</p>

        <!-- Current Scores Display: Grid is responsive by default --><section id="score-display" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <!-- Score Cards will be injected here by renderScores() -->
        </section>

        <!-- Action Buttons (ACNH Style, Circular and with shadow) --><div class="flex flex-wrap justify-center gap-4 mb-8">
            <button id="open-round-modal" class="acnh-button green-main">
                <span class="text-xl mr-2">ğŸ’°</span> æ–°å¢ä¸€å±€ç©åˆ†
            </button>
            <button id="open-setup-modal" class="acnh-button blue-main">
                <span class="text-xl mr-2">âœï¸</span> è¨­å®šå³¶æ°‘åç¨±
            </button>
            <button id="reset-game-btn" class="acnh-button yellow">
                <span class="text-xl mr-2">ğŸï¸</span> é‡è¨­éŠæˆ²
            </button>
        </div>

        <!-- History Section (Styled as a separate scrollable document) -->
        <section class="bg-gray-100 p-6 rounded-3xl shadow-inner border border-gray-300">
            <!-- 2. æ—¥èªŒæ¨™é¡Œå·²æ›´æ”¹ç‚ºè³‡ç”¢è½‰ç§»è¡¨ -->
            <h2 class="text-2xl font-bold mb-4 border-b pb-2 text-yellow-600" style="text-shadow: 1px 1px 0 #FFF;">è³‡ç”¢è½‰ç§»è¡¨ (æœ€è¿‘ 10 ç­†)</h2>
            <ul id="history-list">
                <!-- History list items will be injected here by renderHistory() -->
            </ul>
        </section>
    </div>
    
    <!-- MODALS SECTION -->
    
    <!-- Round Score Modal -->
    <div id="round-modal" class="modal hidden fixed inset-0 z-[60] overflow-y-auto" style="background-color: rgba(0, 0, 0, 0.4);">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content w-full max-w-md border-4 border-yellow-500 transform transition-all">
                <h3 class="text-2xl font-bold mb-4 border-b pb-2 text-green-600">ğŸ’¸ çµç®—æœ¬å›åˆ</h3>
                <div id="round-inputs-container" class="space-y-4 mb-4">
                    <!-- Dynamic player inputs injected -->
                </div>
                <div id="round-total-change" class="text-xl font-bold text-center mb-4 p-2 rounded-lg bg-gray-100">
                    ç¸½è®Šå‹•: 0
                </div>
                <div class="flex justify-end space-x-3">
                    <button id="confirm-round-btn" class="acnh-button green-main w-full sm:w-auto" style="box-shadow: 0 4px 0 0 #4CAF50;">
                        ç¢ºèªä¸¦çµç®—
                    </button>
                    <button type="button" class="close-modal-btn acnh-button bg-gray-400 hover:bg-gray-500 w-full sm:w-auto" style="box-shadow: 0 4px 0 0 #A0AEC0;">
                        å–æ¶ˆ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Player Setup Modal -->
    <div id="setup-modal" class="modal hidden fixed inset-0 z-[60] overflow-y-auto" style="background-color: rgba(0, 0, 0, 0.4);">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content w-full max-w-md border-4 border-blue-500 transform transition-all">
                <h3 class="text-2xl font-bold mb-4 border-b pb-2 text-blue-600">âœï¸ å³¶æ°‘æ›´åæœå‹™</h3>
                <div id="setup-inputs-container" class="space-y-4 mb-4">
                    <!-- Dynamic name inputs injected -->
                </div>
                <div class="flex justify-end space-x-3">
                    <button id="save-names-btn" class="acnh-button blue-main w-full sm:w-auto">
                        å„²å­˜åç¨±
                    </button>
                    <button type="button" class="close-modal-btn acnh-button bg-gray-400 hover:bg-gray-500 w-full sm:w-auto" style="box-shadow: 0 4px 0 0 #A0AEC0;">
                        å–æ¶ˆ
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Reset Confirmation Modal -->
    <div id="reset-confirm-modal" class="modal hidden fixed inset-0 z-[60] overflow-y-auto" style="background-color: rgba(0, 0, 0, 0.4);">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content w-full max-w-md border-4 border-red-500 transform transition-all">
                <h3 class="text-2xl font-bold text-red-600 mb-4 border-b pb-2 border-red-400">ğŸš¨ å³¶å¶¼é‡å•Ÿè­¦å‘Š</h3>
                <p class="mb-4" style="color: var(--color-text-dark);">
                    æ­¤æ“ä½œå°‡**æ¸…é™¤æ‰€æœ‰ç©åˆ†å’Œå°å±€ç´€éŒ„**ï¼Œå°±åƒæ¬åˆ°ä¸€åº§æ–°å³¶å¶¼ä¸€æ¨£ã€‚
                </p>
                <p class="mb-2 font-medium" style="color: var(--color-text-dark);">
                    è«‹è¼¸å…¥ <code class="text-red-500 font-bold">HELLO KIWI</code> é€²è¡Œç¢ºèªï¼š
                </p>
                <input type="text" id="reset-verification-input"
                       class="mt-1 block w-full px-4 py-2 bg-gray-100 border border-red-400 rounded-lg text-var-text-dark focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 sm:text-lg mb-6"
                       placeholder="è¼¸å…¥ HELLO KIWI">
                <div class="flex justify-end space-x-3">
                    <button id="confirm-reset-btn" class="acnh-button yellow w-full sm:w-auto" style="background-color: #F44336; box-shadow: 0 4px 0 0 #D32F2F;">
                        ç¢ºèªé‡å•Ÿ
                    </button>
                    <button type="button" class="close-modal-btn acnh-button bg-gray-400 hover:bg-gray-500 w-full sm:w-auto" style="box-shadow: 0 4px 0 0 #A0AEC0;">
                        å–æ¶ˆ
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
